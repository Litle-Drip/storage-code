<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
<title>The Juice</title>

<style>
  :root {
    --bg: #000000;
    --surface: #1c1c1e;
    --surface-highlight: #2c2c2e;
    --text: #ffffff;
    --text-secondary: #8e8e93;
    --accent: #34c759; /* Apple Green */
    --accent-dim: rgba(52, 199, 89, 0.15);
    --danger: #ff453a;
    --radius: 20px;
    --btn-radius: 12px;
    --ease: cubic-bezier(0.25, 1, 0.5, 1);
  }

  * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
  
  body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }

  /* --- Layout & Container --- */
  .app-container {
    width: 100%;
    max-width: 440px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* --- Header --- */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
  }

  .brand {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .wallet-btn {
    background: var(--surface-highlight);
    color: var(--text);
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s var(--ease);
  }
  .wallet-btn.connected { background: var(--accent-dim); color: var(--accent); }
  .wallet-btn:hover { transform: scale(1.02); }

  /* --- Tabs --- */
  .tabs {
    display: flex;
    background: var(--surface);
    padding: 4px;
    border-radius: 14px;
    margin-bottom: 10px;
  }
  
  .tab-btn {
    flex: 1;
    padding: 10px;
    text-align: center;
    background: transparent;
    border: none;
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 14px;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s var(--ease);
  }
  .tab-btn.active {
    background: var(--surface-highlight);
    color: var(--text);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }

  /* --- Cards --- */
  .card {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 24px;
    display: none; /* Hidden by default, toggled by tabs */
    animation: fadeIn 0.4s var(--ease);
  }
  .card.visible { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  h2 { margin: 0 0 20px 0; font-size: 18px; font-weight: 600; text-align: center; color: var(--text-secondary); }

  /* --- Inputs --- */
  .input-group { margin-bottom: 20px; }
  .label { display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 500; }
  
  .big-input-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin: 20px 0;
  }
  
  .big-input {
    background: transparent;
    border: none;
    font-size: 48px;
    font-weight: 700;
    color: var(--text);
    width: 180px;
    text-align: center;
    outline: none;
    font-feature-settings: "tnum";
  }
  .currency-toggle {
    background: var(--surface-highlight);
    border: none;
    color: var(--text);
    font-size: 12px;
    font-weight: 700;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
  }

  .segmented-control {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
  }
  .segment-btn {
    flex: 1;
    background: var(--surface-highlight);
    border: none;
    padding: 10px;
    border-radius: 10px;
    color: var(--text-secondary);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: 0.2s;
  }
  .segment-btn:hover { background: #3a3a3c; }
  .segment-btn.selected { background: var(--text); color: var(--bg); }

  /* --- Buttons --- */
  .btn-main {
    width: 100%;
    padding: 16px;
    border-radius: var(--radius);
    border: none;
    font-size: 17px;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.1s;
    margin-top: 10px;
  }
  .btn-primary { background: var(--text); color: var(--bg); }
  .btn-primary:active { transform: scale(0.98); }
  
  .btn-secondary { background: var(--surface-highlight); color: var(--text); margin-top: 12px; }
  .btn-ghost { background: transparent; color: var(--text-secondary); font-size: 14px; padding: 10px; margin-top: 8px; width: 100%; border:none; cursor:pointer;}
  .btn-ghost:hover { text-decoration: underline; }

  .btn-vote { flex: 1; padding: 14px; border-radius: 12px; border: 1px solid var(--surface-highlight); background: transparent; color: var(--text); cursor: pointer; }
  .btn-vote:hover { background: var(--surface-highlight); }

  /* --- Utilities --- */
  .row { display: flex; gap: 10px; align-items: center; }
  .hidden { display: none !important; }
  .text-center { text-align: center; }
  .muted { color: var(--text-secondary); font-size: 13px; line-height: 1.4; }
  
  .status-pill {
    margin-top: 16px;
    padding: 10px;
    border-radius: 10px;
    background: var(--surface-highlight);
    font-size: 13px;
    text-align: center;
    color: var(--text-secondary);
    display: none; /* JS toggles flex */
  }

  /* QR Area */
  #qrBox {
    background: white;
    padding: 10px;
    border-radius: 12px;
    width: fit-content;
    margin: 20px auto;
  }
  
  /* Summary Footer */
  .info-stack {
    margin-top: 30px;
    padding: 20px;
    background: var(--surface);
    border-radius: var(--radius);
    font-size: 13px;
    color: var(--text-secondary);
  }
  .info-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
  .info-val { color: var(--text); font-weight: 600; }
  .network-pill { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.5; margin-top: 20px; text-align: center;}

  /* Idea Box */
  .idea-box {
    background: var(--surface-highlight);
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .idea-text { font-size: 14px; font-weight: 500; font-style: italic; color: var(--text); }

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js"></script>
</head>

<body>

<div class="app-container">
  
  <div class="header">
    <div class="brand">ðŸ§ƒ The Juice</div>
    <button id="btnConnect" class="wallet-btn">Connect Wallet</button>
  </div>

  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('create')">Create Bet</button>
    <button class="tab-btn" onclick="switchTab('manage')">Join & Resolve</button>
  </div>

  <div id="tab-create" class="card visible">
    
    <div class="idea-box">
      <span id="ideaBoxText" class="idea-text">"Make a 3-point shot..."</span>
      <button id="btnShuffle" style="background:none;border:none;cursor:pointer;font-size:18px">ðŸŽ²</button>
      <input id="ideaBox" type="hidden" value=""/> </div>

    <div class="text-center">
      <label class="label">I want to bet</label>
      <div class="big-input-wrapper">
        <span id="currencySymbol" style="font-size: 32px; color:var(--text-secondary)">Îž</span>
        <input id="stakeMain" class="big-input" type="number" step="0.0001" value="0.0014" placeholder="0.00" />
        <div style="display:flex; flex-direction:column; gap:4px">
           <button id="stakeModeEth" class="currency-toggle">ETH</button>
           <button id="stakeModeUsd" class="currency-toggle" style="opacity:0.5">USD</button>
        </div>
      </div>
    </div>

    <div class="segmented-control">
      <button class="segment-btn" id="usd1">$1</button>
      <button class="segment-btn" id="usd5">$5</button>
      <button class="segment-btn" id="usd20">$20</button>
    </div>

    <div class="label">Join Deadline</div>
    <div class="segmented-control">
      <button class="segment-btn" onclick="setJoin(15)">Quick (15m)</button>
      <button class="segment-btn" onclick="setJoin(60)">1h</button>
      <button class="segment-btn" onclick="setJoin(1440)">1 Day</button>
      <input id="joinMins" type="number" class="segment-btn" style="width:60px; text-align:center" value="15" placeholder="min">
    </div>

    <div class="label">Resolve Deadline</div>
    <div class="segmented-control">
      <button class="segment-btn" onclick="setResolve(30)">+30m</button>
      <button class="segment-btn" onclick="setResolve(120)">+2h</button>
      <button class="segment-btn" onclick="setResolve(2880)">+2 Days</button>
      <input id="resolveMins" type="number" class="segment-btn" style="width:60px; text-align:center" value="30" placeholder="min">
    </div>

    <input id="stakeEth" type="hidden" value="0.0014"/>
    <input id="stakeUsd" type="hidden" value="5"/>
    <input id="feeBps" type="hidden" value="250"/>

    <button id="btnCreate" class="btn-main btn-primary">Create & Fund</button>
    <div id="createStatus" class="status-pill"></div>
    
    <button id="btnReset" class="hidden"></button> 
    <button id="ethMinus" class="hidden"></button>
    <button id="ethPlus" class="hidden"></button>
  </div>

  <div id="tab-manage" class="card">
    <div class="input-group">
      <label class="label">Bet ID</label>
      <div class="row">
        <input id="betId" class="segment-btn" style="text-align:left; background:var(--surface-highlight); color:var(--text); cursor:text;" placeholder="Paste ID here..." />
        <button id="btnNewBet" class="currency-toggle">New ID</button>
      </div>
    </div>

    <div id="shareSection" style="text-align:center; margin-bottom:24px; display:none;">
      <div id="qrBox"></div>
      <input id="shareUrl" style="width:100%; background:transparent; border:none; color:var(--text-secondary); font-size:12px; text-align:center; margin-top:10px" readonly/>
      <button id="btnCopy" class="btn-ghost">Copy Link</button>
      <div id="newBetNote" class="muted" style="margin-top:8px; color:var(--accent)">Ready to share</div>
    </div>

    <div class="row">
      <button id="btnJoin" class="btn-main btn-primary">Join Bet</button>
    </div>
    <button id="btnRefund" class="btn-main btn-secondary">Request Refund</button>

    <hr style="border:0; border-top:1px solid var(--surface-highlight); margin: 24px 0;">

    <h2>Resolve Winner</h2>
    <p class="muted text-center" style="margin-bottom:16px">Both parties must agree.</p>

    <div class="row" style="align-items:flex-start">
      <div style="flex:1">
        <div class="label text-center">I created this bet</div>
        <button id="creatorWon" class="btn-vote" style="width:100%; margin-bottom:8px">I Won</button>
        <button id="creatorSaysOpponent" class="btn-vote" style="width:100%">Opponent Won</button>
      </div>
      <div style="flex:1">
        <div class="label text-center">I joined this bet</div>
        <button id="opponentSaysCreator" class="btn-vote" style="width:100%; margin-bottom:8px">Creator Won</button>
        <button id="opponentWon" class="btn-vote" style="width:100%">I Won</button>
      </div>
    </div>

    <button id="btnPayout" class="btn-main btn-primary" style="margin-top:24px; background: var(--accent)">Finalize & Payout</button>
    <div id="actionStatus" class="status-pill"></div>
  </div>

  <div class="info-stack">
    <div class="info-row">
      <span>Pot Value</span>
      <span class="info-val"><span id="sbPotEth">0.0000</span> ETH (<span id="sbPotUsd">$0.00</span>)</span>
    </div>
    <div class="info-row">
      <span>Winner Gets</span>
      <span class="info-val" style="color:var(--accent)"><span id="sbWinEth">0.0000</span> ETH (<span id="sbWinUsd">$0.00</span>)</span>
    </div>
    <div class="network-pill">
      Base Sepolia â€¢ Fee 2.5% â€¢ <a id="lastTx" href="#" target="_blank" style="color:inherit; text-decoration:underline">View TX</a>
    </div>
    <div id="sbState" class="hidden"></div>
    <div id="addrPill" class="hidden"></div>
    <div id="btnSwitch" class="hidden"></div> 
  </div>

</div>

<script>
/* -------------------------------------------------------------------------- */
/* UI INTERACTION LOGIC                           */
/* -------------------------------------------------------------------------- */

function switchTab(tab) {
  document.querySelectorAll('.card').forEach(c => c.classList.remove('visible'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  
  if(tab === 'create') {
    document.getElementById('tab-create').classList.add('visible');
    document.querySelectorAll('.tab-btn')[0].classList.add('active');
  } else {
    document.getElementById('tab-manage').classList.add('visible');
    document.querySelectorAll('.tab-btn')[1].classList.add('active');
  }
}

function setJoin(m) { document.getElementById('joinMins').value = m; }
function setResolve(m) { document.getElementById('resolveMins').value = m; }

/* -------------------------------------------------------------------------- */
/* ORIGINAL LOGIC ADAPTATION                          */
/* -------------------------------------------------------------------------- */

const BASE = { idHex: '0x14a34', rpc: 'https://sepolia.base.org', explorer: 'https://sepolia.basescan.org' };
const FEE_BPS = 250;        
let   ETH_USD = 3500;       
const CONTRACT_ADDRESS = '0xD251F4aFB44Fa54Af8E714C8219d5a535Bc59433'; 

const $ = id => document.getElementById(id);
const fmtUsd = v => '$' + v.toFixed(2);

function currentShareUrl() {
  const betId = $('betId').value;
  try {
    const u = new URL(location.href);
    if (betId) u.searchParams.set('bet', betId);
    else u.searchParams.delete('bet');
    return u.toString();
  } catch { return location.href; }
}

let qr = null;
function renderQR() {
  const node = $('qrBox'); node.innerHTML = '';
  const val = $('betId').value;
  
  // UI Logic: Show/Hide Share Section based on ID existence
  if(val && val.length > 0) {
    $('shareSection').style.display = 'block';
    qr = new QRCode(node, { text: currentShareUrl(), width: 140, height: 140, colorDark:'#000000', colorLight:'#ffffff', correctLevel: QRCode.CorrectLevel.M });
  } else {
    $('shareSection').style.display = 'none';
  }
}

/* Preview Updates */
function updatePreview() {
  const eth = parseFloat($('stakeEth').value || '0') || 0;
  const pot = eth * 2;
  const win = pot * (1 - FEE_BPS / 10000);

  if($('sbPotEth')) $('sbPotEth').textContent = pot.toFixed(4);
  if($('sbPotUsd')) $('sbPotUsd').textContent = fmtUsd(pot * ETH_USD);
  if($('sbWinEth')) $('sbWinEth').textContent = win.toFixed(4);
  if($('sbWinUsd')) $('sbWinUsd').textContent = fmtUsd(win * ETH_USD);
}

/* Stake Logic */
let stakeMode = 'ETH'; 

function applyStakeFromEth(rawEth) {
  const eth = Math.max(0, Number(rawEth) || 0);
  $('stakeEth').value = eth.toFixed(4);
  $('stakeUsd').value = (eth * ETH_USD).toFixed(0);
  updatePreview();
}

function handleStakeMainInput() {
  const num = Number($('stakeMain').value) || 0;
  if (stakeMode === 'ETH') {
    applyStakeFromEth(num);
  } else {
    const eth = num / ETH_USD;
    applyStakeFromEth(eth);
  }
}

function setStakeMode(mode) {
  if (mode !== 'ETH' && mode !== 'USD') return;
  stakeMode = mode;
  
  // Visual Toggle
  $('currencySymbol').textContent = mode === 'ETH' ? 'Îž' : '$';
  $('stakeModeEth').style.opacity = mode === 'ETH' ? '1' : '0.5';
  $('stakeModeUsd').style.opacity = mode === 'USD' ? '1' : '0.5';

  const eth = parseFloat($('stakeEth').value || '0') || 0;
  const input = $('stakeMain');
  
  if (mode === 'ETH') {
    input.step = '0.0001';
    input.value = eth.toFixed(4);
  } else {
    input.step = '1';
    input.value = (eth * ETH_USD).toFixed(0);
  }
}

/* Ethers & Contract */
let provider, signer;
const ABI = [
  {type:'function',stateMutability:'payable',   name:'createBet',   inputs:[{name:'stakeWei',type:'uint256'},{name:'feeBps',type:'uint16'},{name:'joinWindowSeconds',type:'uint64'},{name:'resolveWindowSeconds',type:'uint64'}], outputs:[{name:'betId',type:'uint256'}]},
  {type:'function',stateMutability:'payable',   name:'joinBet',     inputs:[{name:'betId',type:'uint256'}], outputs:[]},
  {type:'function',stateMutability:'nonpayable',name:'confirmWinner',inputs:[{name:'betId',type:'uint256'},{name:'creatorWon',type:'bool'}], outputs:[]},
  {type:'function',stateMutability:'nonpayable',name:'refund',      inputs:[{name:'betId',type:'uint256'}], outputs:[]},
  {type:'function',stateMutability:'nonpayable',name:'resolve',     inputs:[{name:'betId',type:'uint256'}], outputs:[]},
  {type:'function',stateMutability:'view',      name:'getBet',      inputs:[{name:'betId',type:'uint256'}], outputs:[{type:'address'},{type:'address'},{type:'uint256'},{type:'uint16'},{type:'uint64'},{type:'uint64'},{type:'uint64'},{type:'uint8'},{type:'int8'},{type:'int8'}]},
  {type:'function',stateMutability:'view',      name:'nextBetId',   inputs:[], outputs:[{type:'uint256'}]}
];

async function ensureBase(){
  if (!window.ethereum) { alert('MetaMask not found'); throw new Error('no wallet'); }
  const chain = await window.ethereum.request({ method:'eth_chainId' });
  if (chain !== BASE.idHex){
    try{
      await window.ethereum.request({ method:'wallet_switchEthereumChain', params:[{ chainId: BASE.idHex }] });
    }catch(e){
      if (e.code === 4902){
        await window.ethereum.request({ method:'wallet_addEthereumChain', params:[{ chainId: BASE.idHex, chainName:'Base Sepolia', nativeCurrency:{name:'ETH',symbol:'ETH',decimals:18}, rpcUrls:[BASE.rpc], blockExplorerUrls:[BASE.explorer]}] });
      } else { throw e; }
    }
  }
}

async function connect(){
  try{
    await ensureBase();
    provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send('eth_requestAccounts',[]);
    signer = await provider.getSigner();
    const btn = $('btnConnect');
    btn.textContent = 'Connected';
    btn.classList.add('connected');
  }catch(e){
    console.error(e);
  }
}
function getContract(){
  if (!signer) throw new Error('Connect your wallet first.');
  return new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
}

/* Actions */
function showStatus(elId, msg, isError=false) {
    const el = $(elId);
    el.style.display = 'block';
    el.textContent = msg;
    el.style.color = isError ? 'var(--danger)' : 'var(--text)';
}

async function doCreate(){
  showStatus('createStatus', 'Confirm in wallet...');
  try{
    if (!signer) await connect();
    const c = getContract();
    const stakeEth = String($('stakeEth').value || '0');

    const jm = Math.max(5,  Math.min(43200, parseInt($('joinMins').value || '15', 10)));
    const rm = Math.max(30, Math.min(43200, parseInt($('resolveMins').value || '30', 10)));
    
    const stakeWei = ethers.parseEther(stakeEth);

    const tx = await c.createBet(stakeWei, FEE_BPS, BigInt(jm * 60), BigInt(rm * 60), { value: stakeWei });
    showStatus('createStatus', 'Pending transaction...');

    await tx.wait();
    $('lastTx').href = `${BASE.explorer}/tx/${tx.hash}`;
    
    const nextId = await c.nextBetId();
    const betId  = (BigInt(nextId) - 1n).toString();
    
    $('betId').value = betId;
    $('shareUrl').value = currentShareUrl();
    renderQR();
    switchTab('manage'); // Auto switch to share/manage view
    showStatus('actionStatus', 'âœ… Bet Created! Share the link above.');
    showStatus('createStatus', 'Done.', false); // clear old status

  }catch(e){
    showStatus('createStatus', (e?.shortMessage||e?.message||e), true);
  }
}
  
async function doJoin(){
  showStatus('actionStatus', 'Confirm in wallet...');
  try{
    if (!signer) await connect();
    const c = getContract();
    const betId = BigInt(String($('betId').value||'0'));
    const b = await c.getBet(betId);
    const stakeWei = b[2];
    const tx = await c.joinBet(betId, { value: stakeWei });
    await tx.wait();
    $('lastTx').href = `${BASE.explorer}/tx/${tx.hash}`;
    showStatus('actionStatus', 'âœ… You have joined the bet.');
  }catch(e){
    showStatus('actionStatus', (e?.shortMessage||e?.message||e), true);
  }
}

async function doVote(creatorWon){
  showStatus('actionStatus', 'Sending vote...');
  try{
    if (!signer) await connect();
    const c = getContract();
    const betId = BigInt(String($('betId').value||'0'));
    const tx = await c.confirmWinner(betId, Boolean(creatorWon));
    await tx.wait();
    $('lastTx').href = `${BASE.explorer}/tx/${tx.hash}`;
    showStatus('actionStatus', 'âœ… Vote submitted.');
  }catch(e){
    showStatus('actionStatus', (e?.shortMessage||e?.message||e), true);
  }
}

async function doRefund(){
  showStatus('actionStatus', 'Requesting refund...');
  try{
    if (!signer) await connect();
    const c = getContract();
    const betId = BigInt(String($('betId').value||'0'));
    const tx = await c.refund(betId);
    await tx.wait();
    $('lastTx').href = `${BASE.explorer}/tx/${tx.hash}`;
    showStatus('actionStatus', 'âœ… Refund processed.');
  }catch(e){
    showStatus('actionStatus', (e?.shortMessage||e?.message||e), true);
  }
}

async function doPayout(){
  showStatus('actionStatus', 'Finalizing...');
  try{
    if (!signer) await connect();
    const c = getContract();
    const betId = BigInt(String($('betId').value||'0'));
    const tx = await c.resolve(betId);
    await tx.wait();
    $('lastTx').href = `${BASE.explorer}/tx/${tx.hash}`;
    showStatus('actionStatus', 'âœ… Payout Complete!');
  }catch(e){
    showStatus('actionStatus', (e?.shortMessage||e?.message||e), true);
  }
}

/* Ideas & Utilities */
const IDEAS = [
  "Make a 3-point shot from top of key",
  "Darts: Hit a double in 3 throws",
  "Chug beer under 1 minute",
  "Hit the crossbar (Soccer)",
  "Bottle Flip: 3 out of 5",
  "Golf: Hole in one!",
  "Pool: Bank shot within 2 tries",
  "Ping pong: Serve an ace"
];
function shuffleIdea(){
  const txt = IDEAS[Math.floor(Math.random()*IDEAS.length)];
  $('ideaBoxText').textContent = `"${txt}"`;
  $('ideaBox').value = txt;
}

function genBetId(){ return String(Math.floor(10_000_000 + Math.random()*90_000_000)); }
function startNewBet(){
  const id = genBetId();
  $('betId').value = id;
  $('shareUrl').value = currentShareUrl();
  renderQR();
}

/* Init */
window.addEventListener('DOMContentLoaded', ()=>{
  setStakeMode('ETH');
  applyStakeFromEth($('stakeEth').value || '0');

  $('stakeMain').addEventListener('input', handleStakeMainInput);
  $('stakeModeEth').onclick = ()=> setStakeMode('ETH');
  $('stakeModeUsd').onclick = ()=> setStakeMode('USD');

  $('usd1').onclick  = ()=>{ setStakeMode('USD'); $('stakeMain').value = 1;  handleStakeMainInput(); };
  $('usd5').onclick  = ()=>{ setStakeMode('USD'); $('stakeMain').value = 5;  handleStakeMainInput(); };
  $('usd20').onclick = ()=>{ setStakeMode('USD'); $('stakeMain').value = 20; handleStakeMainInput(); };

  $('betId').addEventListener('input', ()=>{ $('shareUrl').value = currentShareUrl(); renderQR(); });
  $('btnCopy').onclick = async ()=>{ try{ await navigator.clipboard.writeText($('shareUrl').value); $('btnCopy').textContent='Copied!'; setTimeout(()=>$('btnCopy').textContent='Copy Link',1500); }catch{} };

  $('btnConnect').onclick = connect;
  $('btnCreate').onclick = doCreate;
  $('btnJoin').onclick   = doJoin;
  $('btnRefund').onclick = doRefund;
  
  $('creatorWon').onclick= ()=>doVote(true);
  $('creatorSaysOpponent').onclick= ()=>doVote(false);
  $('opponentSaysCreator').onclick= ()=>doVote(true);
  $('opponentWon').onclick= ()=>doVote(false);
  $('btnPayout').onclick = doPayout;

  $('btnShuffle').onclick = shuffleIdea;
  $('btnNewBet').onclick = startNewBet;

  // Load from URL
  const p = new URLSearchParams(location.search); 
  const b = p.get('bet'); 
  if (b){ 
      $('betId').value=b; 
      $('shareUrl').value=currentShareUrl(); 
      renderQR(); 
      switchTab('manage'); // Auto open manage tab if link has ID
  }
});
</script>
</body>
</html>
